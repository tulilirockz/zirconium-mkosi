#!/bin/bash
set -xeuo pipefail

if command -v authselect >/dev/null; then
    authselect select local
fi

if [[ -d /etc/pam.d ]]; then
    find /etc/pam.d -mindepth 1 -exec mv {} /usr/lib/pam.d \;
    rmdir /etc/pam.d
fi

# For podman rootless
chmod 0755 /usr/bin/newuidmap /usr/bin/newgidmap
setcap cap_setuid+ep /usr/bin/newuidmap
setcap cap_setgid+ep /usr/bin/newgidmap
chmod -s /usr/bin/newuidmap
chmod -s /usr/bin/newgidmap
